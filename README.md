# code-diff-fixer
So you asked an LLM to generate a code diff, tried to apply it with `git apply`, and got a bunch of malformed patch errors? Well fear no more, `patch_fixer.py` is here to save the day... more or less.

## Usage
```
python patch_fixer.py original_file broken.patch fixed.patch
```
where `original_file` is the file you were trying to patch, 
`broken.patch` is the malformed patch generated by the LLM, 
and `fixed.patch` is the output file containing the (hopefully) fixed patch.

## Limitations
This script only fixes errors in the hunk header, that is, the parts of the patch that look like this:
```
@@ -348,15 +348,15 @@ class Game:
```
LLMs are quite bad at getting those hunk headers to line up with the correct parts of the file.
This script assumes whatever numbers are there are completely wrong, and regenerates them from scratch based on the original file.
This doesn't always work, because sometimes the LLM hallucinates part of the content after the hunk header,
so the string isn't an exact match, rendering the original content unfindable.
If it can't find those lines in the original file, this script gives up and puts `1` for the line number, like so:
```
@@ -1,15 +1,15 @@ class Game:
```
Every effort is made to make sure the line *counts* are still accurate, but you'll have to edit the correct line number in these cases if you want the patch to work in `git apply`.

## License

This is free and open source software, released under the GNU General Public License v3.0. See `LICENSE` for details.
